"""
Font2LED - 小津ちゃん LED表示スクリプト（完全版）
Skybrush LED Effects用（520-550フレーム）
JSONデータをBlenderテキストエディタに貼り付けて使用
"""

import json

# 実際のJSONデータから抽出したピクセル情報を埋め込み
OZUCHAN_PIXELS = [
    {"x": 7, "y": 1}, {"x": 14, "y": 1}, {"x": 15, "y": 1}, {"x": 22, "y": 1}, {"x": 23, "y": 1}, {"x": 32, "y": 1}, {"x": 57, "y": 1},
    {"x": 7, "y": 2}, {"x": 16, "y": 2}, {"x": 17, "y": 2}, {"x": 19, "y": 2}, {"x": 20, "y": 2}, {"x": 21, "y": 2}, {"x": 31, "y": 2}, {"x": 32, "y": 2}, {"x": 33, "y": 2}, {"x": 40, "y": 2}, {"x": 42, "y": 2}, {"x": 44, "y": 2}, {"x": 45, "y": 2}, {"x": 46, "y": 2}, {"x": 49, "y": 2}, {"x": 56, "y": 2}, {"x": 57, "y": 2}, {"x": 58, "y": 2},
    {"x": 4, "y": 3}, {"x": 5, "y": 3}, {"x": 6, "y": 3}, {"x": 7, "y": 3}, {"x": 8, "y": 3}, {"x": 9, "y": 3}, {"x": 10, "y": 3}, {"x": 16, "y": 3}, {"x": 17, "y": 3}, {"x": 18, "y": 3}, {"x": 22, "y": 3}, {"x": 23, "y": 3}, {"x": 30, "y": 3}, {"x": 31, "y": 3}, {"x": 32, "y": 3}, {"x": 33, "y": 3}, {"x": 34, "y": 3}, {"x": 40, "y": 3}, {"x": 41, "y": 3}, {"x": 42, "y": 3}, {"x": 43, "y": 3}, {"x": 44, "y": 3}, {"x": 45, "y": 3}, {"x": 46, "y": 3}, {"x": 47, "y": 3}, {"x": 48, "y": 3}, {"x": 49, "y": 3}, {"x": 56, "y": 3}, {"x": 57, "y": 3}, {"x": 58, "y": 3},
    {"x": 7, "y": 4}, {"x": 13, "y": 4}, {"x": 14, "y": 4}, {"x": 15, "y": 4}, {"x": 16, "y": 4}, {"x": 17, "y": 4}, {"x": 18, "y": 4}, {"x": 19, "y": 4}, {"x": 20, "y": 4}, {"x": 21, "y": 4}, {"x": 22, "y": 4}, {"x": 23, "y": 4}, {"x": 24, "y": 4}, {"x": 25, "y": 4}, {"x": 32, "y": 4}, {"x": 42, "y": 4}, {"x": 44, "y": 4}, {"x": 45, "y": 4}, {"x": 46, "y": 4}, {"x": 49, "y": 4}, {"x": 55, "y": 4}, {"x": 56, "y": 4}, {"x": 57, "y": 4}, {"x": 58, "y": 4}, {"x": 59, "y": 4},
    {"x": 7, "y": 5}, {"x": 17, "y": 5}, {"x": 18, "y": 5}, {"x": 19, "y": 5}, {"x": 20, "y": 5}, {"x": 21, "y": 5}, {"x": 22, "y": 5}, {"x": 23, "y": 5}, {"x": 32, "y": 5}, {"x": 39, "y": 5}, {"x": 40, "y": 5}, {"x": 41, "y": 5}, {"x": 42, "y": 5}, {"x": 43, "y": 5}, {"x": 44, "y": 5}, {"x": 45, "y": 5}, {"x": 46, "y": 5}, {"x": 47, "y": 5}, {"x": 48, "y": 5}, {"x": 49, "y": 5}, {"x": 50, "y": 5}, {"x": 57, "y": 5},
    {"x": 7, "y": 6}, {"x": 16, "y": 6}, {"x": 17, "y": 6}, {"x": 18, "y": 6}, {"x": 19, "y": 6}, {"x": 20, "y": 6}, {"x": 21, "y": 6}, {"x": 22, "y": 6}, {"x": 23, "y": 6}, {"x": 24, "y": 6}, {"x": 32, "y": 6}, {"x": 42, "y": 6}, {"x": 43, "y": 6}, {"x": 44, "y": 6}, {"x": 45, "y": 6}, {"x": 46, "y": 6}, {"x": 47, "y": 6}, {"x": 57, "y": 6},
    {"x": 5, "y": 7}, {"x": 6, "y": 7}, {"x": 15, "y": 7}, {"x": 16, "y": 7}, {"x": 17, "y": 7}, {"x": 18, "y": 7}, {"x": 19, "y": 7}, {"x": 20, "y": 7}, {"x": 21, "y": 7}, {"x": 22, "y": 7}, {"x": 23, "y": 7}, {"x": 24, "y": 7}, {"x": 25, "y": 7}, {"x": 32, "y": 7}, {"x": 40, "y": 7}, {"x": 41, "y": 7}, {"x": 42, "y": 7}, {"x": 44, "y": 7}, {"x": 45, "y": 7}, {"x": 46, "y": 7}, {"x": 47, "y": 7}, {"x": 48, "y": 7}, {"x": 49, "y": 7}, {"x": 50, "y": 7}, {"x": 57, "y": 7},
    {"x": 4, "y": 8}, {"x": 7, "y": 8}, {"x": 8, "y": 8}, {"x": 19, "y": 8}, {"x": 20, "y": 8}, {"x": 32, "y": 8}, {"x": 42, "y": 8}, {"x": 43, "y": 8}, {"x": 47, "y": 8}, {"x": 48, "y": 8}, {"x": 57, "y": 8},
    {"x": 9, "y": 9}, {"x": 10, "y": 9}, {"x": 57, "y": 9}
]

def main(frame, time_fraction, drone_index, formation_index, position, drone_count):
    """
    Skybrush LED Effects メイン関数
    10×65 LEDスクリーン用（標準サイズ）
    """
    
    # デフォルト色（消灯）
    default_color = (0.0, 0.0, 0.0, 1.0)
    
    # ドローンの位置を取得
    x = position[0]
    z = position[2]
    
    # LEDスクリーンの座標範囲（10×65の場合）
    # X: -97.5 ~ 97.5 (65列 × 3.0間隔)
    # Z: 0 ~ 27 (10行 × 3.0間隔)
    
    # グリッド座標に変換
    col = int((x + 97.5) / 3.0)  # 0-64
    row = 9 - int(z / 3.0)  # 0-9（上下反転）
    
    # 範囲チェック
    if not (0 <= col < 65 and 0 <= row < 10):
        return default_color
    
    # 「小津ちゃん」のピクセルをチェック
    for pixel in OZUCHAN_PIXELS:
        if pixel["x"] == col and pixel["y"] == row:
            # 赤色で表示
            return (1.0, 0.0, 0.0, 1.0)
    
    return default_color