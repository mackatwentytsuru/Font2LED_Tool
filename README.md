# Font2LED Tool

日本語フォントを使用してテキストをLEDマトリックスデータに変換するGUIツールです。Skybrush StudioやBlenderとの連携でドローンライトショーの作成に特化しています。

## 主な機能

### 📝 フォント対応
- **JF-Dot-k12x10** (12×10ピクセル) - 基本フォント
- **k8x12** (8×12ピクセル) - 標準フォント
- **k8x12L** (8×12ピクセル) - 細字フォント  
- **k8x12S** (8×12ピクセル) - 太字フォント
- **マルミーニャ** (12×12ピクセル) - 丸ゴシックフォント

### 🎯 LEDスクリーン設定
- **10×65** (標準650ドローン)
- **13×50** (Blender実測)
- **カスタムサイズ** (行数・列数自由設定)
- **自動中央配置** (水平・垂直方向)

### 🚁 ドローンショー対応
- **Skybrush Studio** Custom Expression エクスポート
- **Blender** JSON アニメーションデータ
- **650ドローン最適化** (5文字表示対応)
- **2mドローン間隔** 対応

### 🎨 プレビュー機能
- **リアルタイムプレビュー** (LEDグリッド表示)
- **ズーム・スケール調整**
- **カラー選択** (RGB設定)
- **画像エクスポート** (PNG形式)

### 🎬 アニメーション機能 (NEW!)
- **4方向スクロール** (右→左、左→右、上→下、下→上)
- **プレビュー再生** (▶再生、⏸一時停止、⏹停止)
- **速度調整** (1-30秒の任意設定)
- **進行度表示** (スライダーとタイマー)
- **アニメーション付きエクスポート** (Skybrush Custom Expression)

## インストール

### 必要環境
- Python 3.8+
- Windows 10/11

### 依存ライブラリ
```bash
pip install -r requirements.txt
```

**requirements.txt:**
```
freetype-py>=2.3.0
pillow>=9.0.0
numpy>=1.21.0
tkinter  # 通常はPythonに含まれています
```

## 使い方

### GUIアプリケーション起動
```bash
python font2led_gui.py
```

### 基本操作手順

1. **フォント選択**
   - ドロップダウンから使用フォントを選択
   - k8x12フォント系が650ドローンに最適

2. **テキスト入力**
   - テキストボックスに表示したい文字を入力
   - 日本語（ひらがな・カタカナ・漢字）対応

3. **LEDスクリーン設定**
   - 標準サイズまたはカスタム設定を選択
   - カスタム設定で行数・列数を自由に変更

4. **色選択**
   - カラーボタンでLED色を指定
   - RGB値での詳細設定

5. **プレビュー確認**
   - プレビュー生成ボタンでLEDグリッド表示
   - ズーム調整で表示サイズ変更

6. **アニメーション設定** (オプション)
   - アニメーション有効にチェック
   - スクロール方向を選択（右→左、左→右、上→下、下→上）
   - アニメーション時間を設定（1-30秒）
   - ▶再生ボタンでプレビュー確認

7. **エクスポート**
   - **JSONエクスポート**: Blender用アニメーションデータ
   - **Custom Expressionエクスポート**: Skybrush Studio用（静止画）
   - **アニメーションエクスポート**: Skybrush Studio用（アニメーション）
   - **画像保存**: PNG形式でプレビュー保存

## 主要な修正・改善点

### 🔧 Version 3.0 の新機能 (最新)

#### 🎬 アニメーション機能
- **4方向スクロール**: 右→左、左→右、上→下、下→上の全方向対応
- **リアルタイムプレビュー**: GUI内でアニメーション再生・一時停止・停止
- **可変速度**: 1〜30秒の範囲で自由な速度設定
- **進行度制御**: スライダーでアニメーション位置の手動操作
- **時間表示**: 現在時間/総時間の詳細表示
- **アニメーション専用エクスポート**: time_fraction対応のSkybrush Custom Expression

#### プレビューシステム刷新
- **統合キャンバス**: 静止画とアニメーションの統一表示
- **30fps再生**: 滑らかなアニメーション表示
- **メモリ最適化**: アニメーション状態の効率的管理

### 🔧 Version 2.0 の新機能

#### フォント表示修正
- **k8x12フォント系の表示改善**: 異常に細い表示を修正
- **フォントサイズ最適化**: 8×12 → 16×16 でより見やすく

#### 中央配置機能
- **垂直中央配置**: カスタム行数でも文字が中央に表示
- **水平中央配置**: 既存機能と組み合わせて完全中央配置
- **境界チェック**: 画面外はみ出し防止

#### Unicode対応
- **日本語パス対応**: フォントファイルパスの日本語文字問題を解決
- **一時ファイル方式**: ASCII文字のみのパスで安定動作
- **自動クリーンアップ**: アプリ終了時に一時ファイル削除

## エクスポート形式

### Skybrush Studio Custom Expression（静止画）

```python
# Generated by Font2LED Tool
def main(frame, time_fraction, drone_index, formation_index, position, drone_count):
    # ドローン位置からグリッド座標を計算
    grid_x = int(round((position[0] + 64.0) / 2.0))
    grid_y = int(round((position[2] + 9.0) / 2.0))
    
    # LEDピクセルデータと照合
    if (grid_x, grid_y) in LED_PIXELS:
        return 1.0  # Color Rampで色に変換
    else:
        return 0.0  # 消灯
```

### Skybrush Studio Custom Expression（アニメーション）

```python
# Generated by Font2LED Tool - Animation Export
def animated_text_scroll_right_to_left(frame, time_fraction, drone_index, formation_index, position, drone_count):
    """
    右→左アニメーション - "小津ちゃん"
    """
    # グリッド座標変換
    grid_x = int(round((position[0] - X_MIN) / (X_MAX - X_MIN) * (GRID_WIDTH - 1)))
    grid_z = int(round((position[2] - Z_MIN) / (Z_MAX - Z_MIN) * (GRID_HEIGHT - 1)))
    grid_z = GRID_HEIGHT - 1 - grid_z  # 上下反転
    
    # アニメーション計算: 右から左へのスクロール
    scroll_distance = GRID_WIDTH + TEXT_WIDTH
    animated_x_offset = int(scroll_distance * (1 - time_fraction)) - TEXT_WIDTH
    
    # ピクセルデータとの照合
    for pixel_x, pixel_z in PIXELS:
        animated_pixel_x = pixel_x + animated_x_offset
        if (abs(animated_pixel_x - grid_x) < 0.5 and pixel_z == grid_z):
            return 1.0  # Color Rampで色に変換
    
    return 0.0  # 背景
```

### Blender JSON Animation

```json
{
  "metadata": {
    "grid_width": 50,
    "grid_height": 13,
    "frame_count": 1,
    "font": "k8x12",
    "drone_spacing_m": 2.0
  },
  "frames": [
    {
      "frame": 0,
      "text": "小津ちゃん",
      "pixels": [
        {"x": 15, "y": 4, "r": 1.0, "g": 0.0, "b": 0.0},
        {"x": 16, "y": 4, "r": 1.0, "g": 0.0, "b": 0.0}
      ]
    }
  ]
}
```

## アニメーション機能の使い方

### 基本的な操作手順

1. **通常通りテキストとフォントを設定**
2. **「アニメーション有効」にチェック**
3. **方向を選択**: 右→左、左→右、上→下、下→上
4. **時間を設定**: 1-30秒（デフォルト: 3秒）
5. **プレビューで確認**: ▶再生ボタンでアニメーション開始
6. **調整**: 一時停止⏸や停止⏹で細かい確認
7. **エクスポート**: 「アニメーションエクスポート」ボタンで出力

### アニメーション設定のコツ

- **短いテキスト**: 1-3文字なら高速（1-2秒）がおすすめ
- **長いテキスト**: 4文字以上なら標準速度（3-5秒）
- **垂直スクロール**: 上↔下は文字の高さに応じて時間調整
- **プレビュー活用**: 実際の見た目で速度を最終調整

### Skybrush Studioでの使用

1. **Light Effects**で新しいエフェクト作成
2. **Type**: COLOR_RAMP、**Output**: CUSTOM選択
3. **File**: エクスポートしたテキストブロック名を選択
4. **Color Ramp**: 0.0→黒、1.0→希望の色に設定
5. **再生**: time_fractionに基づいてアニメーション表示

## 650ドローン最適化

### フォント選択指針
- **k8x12**: 標準的な表示、5文字対応
- **k8x12L**: 細字で省スペース、5-6文字対応  
- **k8x12S**: 太字で視認性重視、4-5文字対応
- **マルミーニャ**: 丸文字でかわいい演出、4文字対応

### スクリーン設定推奨値
- **13×50 (650ドローン最適)**: 5文字表示に最適
- **10×65 (650ドローン最適)**: 横長表示、文字間隔広め

## トラブルシューティング

### フォント読み込みエラー
- フォントファイルパスに日本語が含まれる場合は自動で解決
- 一時ディレクトリへのコピーで対応

### 表示が切れる問題
- カスタム行数設定で中央配置が自動適用
- 文字サイズと画面サイズのバランスを確認

### プレビューが表示されない
- フォント選択を確認
- テキスト入力を確認  
- 色設定（黒色の場合は見えない）を確認

## 開発・貢献

### ファイル構成
```
Font2LED_Tool/
├── font2led_gui.py          # メインGUIアプリケーション
├── font2led.py              # コアライブラリ  
├── requirements.txt         # 依存関係
├── README.md               # このファイル
├── k8x12_ttf_2021-05-05/   # k8x12フォント
├── x12y12pxMaruMinya_2023-07-14/  # マルミーニャフォント
└── 書き出し/               # エクスポート先ディレクトリ
```

### 貢献方法
1. このリポジトリをフォーク
2. 機能ブランチを作成
3. 変更をコミット
4. プルリクエストを作成

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

フォントライセンス:
- JF-Dot-k12x10: SIL Open Font License
- k8x12: 自由に使用可能
- マルミーニャ: SIL Open Font License

## 関連プロジェクト

- [Skybrush Studio](https://skybrush.io/) - ドローンショー作成ソフトウェア
- [Blender](https://www.blender.org/) - 3Dモデリング・アニメーション
- [JF-Dot-k12x10 Font](https://github.com/tamzen/JF-Dot-k12x10) - ベースフォント

---

**Font2LED Tool** - ドローンライトショーのためのプロフェッショナルテキスト変換ツール